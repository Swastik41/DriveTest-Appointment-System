<!DOCTYPE html>
<html lang="en">
<%- include('layouts/header') %>

<body>
  <!-- Navigation -->
  <%- include('layouts/navbar') %>

  <!-- Page Header -->
  <header class="masthead" style="background-color: black;">
    <div class="container position-relative px-4 px-lg-5">
      <div class="row justify-content-center">
        <div class="col-md-10 text-center">
          <div class="page-heading">
            <h1 class="display-5 text-white">üõ£Ô∏è G Test Booking</h1>
            <span class="subheading text-light">Please confirm/update your details</span>
          </div>
        </div>
      </div>
    </div>
  </header>
  

  <!-- Main Content -->
  <main class="py-5">
    <div class="container px-4 px-lg-5">
      <div class="row justify-content-center">
        <div class="col-md-10 col-lg-8 col-xl-7">

          <h2 class="text-center mb-4 fw-bold">üìù Review & Update Your Info</h2>

          <!-- Car Info Update Form -->
          <form id="updateCarForm" action="/gtest/updateCar" method="POST">

            <!-- Personal Info (Disabled) -->
            <div class="card shadow-sm border-0 mb-4">
              <div class="card-body">
                <fieldset class="border-start border-4 border-primary ps-3">
                  <legend class="fw-semibold text-primary mb-3">
                    <h4 class="mb-0">üìã Personal Information</h4>
                  </legend>
                  <p class="text-muted mb-3">This information is read-only.</p>

                  <div class="mb-3">
                    <label for="firstName" class="form-label">First Name</label>
                    <input type="text" class="form-control" id="firstName" value="<%= user.firstName %>" disabled>
                  </div>
                  <div class="mb-3">
                    <label for="lastName" class="form-label">Last Name</label>
                    <input type="text" class="form-control" id="lastName" value="<%= user.lastName %>" disabled>
                  </div>
                  <div class="mb-3">
                    <label for="age" class="form-label">Age</label>
                    <input type="number" class="form-control" id="age" value="<%= user.age %>" disabled>
                  </div>
                </fieldset>
              </div>
            </div>

            <!-- Car Info (Editable) -->
            <div class="card shadow-sm border-0 mb-4">
              <div class="card-body">
                <fieldset class="border-start border-4 border-success ps-3">
                  <legend class="fw-semibold text-success mb-3">
                    <h4 class="mb-0">üöò Car Information</h4>
                  </legend>

                  <div class="mb-3">
                    <label for="carMake" class="form-label">Make</label>
                    <input type="text" class="form-control" id="carMake" name="car_information[make]"
                      value="<%= user.car_details.make %>" placeholder="Car make">
                  </div>
                  <div class="mb-3">
                    <label for="carModel" class="form-label">Model</label>
                    <input type="text" class="form-control" id="carModel" name="car_information[model]"
                      value="<%= user.car_details.model %>" placeholder="Car model">
                  </div>
                  <div class="mb-3">
                    <label for="carYear" class="form-label">Year</label>
                    <input type="number" class="form-control" id="carYear" name="car_information[year]" maxlength="4"
                      value="<%= user.car_details.year %>" placeholder="Car year">
                  </div>
                  <div class="mb-3">
                    <label for="platNo" class="form-label">Plate Number</label>
                    <input type="text" class="form-control" id="platNo" name="car_information[platNo]" maxlength="8"
                      value="<%= user.car_details.platNo %>" placeholder="Plate number">
                  </div>
                </fieldset>

                <!-- Update Button -->
                <div class="text-start mt-3">
                  <button type="submit" class="btn btn-success px-4" style="border-radius: 10px;">Update Car Info</button>
                </div>
              </div>
            </div>
          </form>

          <!-- Appointment Booking Form -->
          <div class="card shadow-sm border-0 mb-4">
            <div class="card-body">
              <fieldset class="border-start border-4 border-info ps-3">
                <legend class="fw-semibold text-info mb-3">üìÖ Appointment Booking</legend>

                <!-- Date Picker -->
                <form method="GET" action="/gtest">
                  <div class="mb-3">
                    <label for="appointmentDate" class="form-label">Select Date</label>
                    <input type="date" class="form-control" name="date" id="appointmentDate"
                      value="<%= selectedDate %>" onchange="this.form.submit()" required>
                  </div>
                </form>

                <!-- Time Slots + Book -->
                <form method="POST" action="/gtest/book">
                  <input type="hidden" name="appointmentDate" value="<%= selectedDate %>">

                  <% if (slots && slots.length > 0) { %>
                    <label class="form-label">Available Time Slots</label>
                    <div class="d-flex flex-wrap gap-2 mb-3">
                      <% slots.forEach(slot => { %>
                        <label class="btn btn-outline-primary">
                          <input type="radio" class="btn-check" name="appointmentId" value="<%= slot._id %>" required>
                          <%= slot.time %>
                        </label>
                      <% }) %>
                    </div>
                  <% } else if (typeof slots !== 'undefined') { %>
                    <p class="text-danger">No available slots for selected date.</p>
                  <% } %>

                  <div class="text-start mt-3">
                    <button type="submit" class="btn btn-primary px-4" style="border-radius: 10px;">
                      Book Appointment
                    </button>
                  </div>
                </form>
              </fieldset>
            </div>
          </div>

        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <%- include('layouts/footer') %>
  <!-- Scripts -->
  <%- include('layouts/scripts') %>
</body>

</html>
